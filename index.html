<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Data Visualization Fadhil Mochammad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
  <h1>World CO2 Emission</h1>
  <div id='graph'></div>
</body>
<script>
  const width = 1000
  const height = 600

  const canvas = d3.select('#graph').append('svg')
    .attr('width', width)
    .attr('height', height)
    .style('background', '#eceff1')
    .style('margin-left', 100)
  
  const g = canvas.append('g')

  // Scale range into canvas size
  var xScale = d3.scaleLinear().rangeRound([0,width])
  var yScale = d3.scaleLinear().rangeRound([height, 0])


  // Parse the data form input csv, to make sure that number is not string
  function type (d) {
    d.country_or_area = d.country_or_area
    d.year = d.year
    d.value = +d.value
    d.category = d.category
    return d
  }

  // Read data from csv file
  d3.csv('./greenhouse_gas_inventory_data_data.csv', type, function(data) {
    console.log('masuk')
    let co2_data_raw = data.filter(val => {
      return val.category === 'carbon_dioxide_co2_emissions_without_land_use_land_use_change_and_forestry_lulucf_in_kilotonne_co2_equivalent'
    })
    
    let co2_data = []
    
    co2_data_raw.forEach(val => {
      if(co2_data.findIndex(co2 => {
        return co2.country === val.country_or_area
      }) === -1) 
        {
          co2_data.push({
            country: val.country_or_area,
            data: []
          })
        }
    })

    co2_data_raw.forEach(val => {
      let index = co2_data.findIndex(co2 => {
        return co2.country === val.country_or_area
      })
      co2_data[index].data.push({
        year: val.year,
        value: val.value
      })
    })
    console.log(co2_data)

    let dataAustralia = co2_data.filter(val => {
      return val.country === 'Australia'
    })[0].data

    console.log(dataAustralia)
    
    // Get the range of data for domain scaling
    xScale.domain(d3.extent(dataAustralia, function (d) {
      return d.year
    }))

    yScale.domain(d3.extent(dataAustralia, function (d) {
      return d.value
    }))

     const lines = g.selectAll('path')
    .data(dataAustralia)
    .enter()
    .append('path')
    .attr("fill", "none")
    .attr("stroke", "black")
    .attr("stroke-linejoin", "round")
    .attr("stroke-linecap", "round")
    .attr("stroke-width", 3)
    .attr('d', function (d, i) {
      if(i <  dataAustralia.length-1) {
        console.log(i)
        console.log(dataAustralia[i+1])
        return `M ${xScale(d.year)} ${yScale(d.value)} L ${xScale(dataAustralia[i+1].year)} ${yScale(dataAustralia[i+1].value)}`
      }
    })

    // Add circle to canvas
    const circles = g.selectAll('circle').data(dataAustralia)
    circles.enter().append('circle')
      .attr('stroke','white')
      .attr('stroke-width', 3)
      .attr('r', 6)
      .attr('cx', function (d) {
        return xScale(d.year)
      })
      .attr('cy', function (d) {
        return yScale(d.value)
      })

   

  })
</script>
</html>